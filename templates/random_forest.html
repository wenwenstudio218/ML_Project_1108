{% extends "base.html" %}

{% block title %}隨機森林 - 離職預測{% endblock %}

{% block head %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/prediction.css') }}">
{% endblock %}

{% block content %}
<div class="page-header">
    <h1>隨機森林 Random Forest</h1>
    <p>調整下方的壓力特徵滑桿，即時預測勞工的離職傾向機率</p>
</div>

<div class="batch-evaluation-wrapper">
    <div class="card-style">
        <h2 class="panel-title">新資料批次評估</h2>
        <p>點擊按鈕以載入 <code>110年-勞工生活及就業狀況調查(北北桃)</code> 資料，並使用 隨機森林模型 進行預測與評估。</p>
        <button id="run-evaluation-btn" class="btn-primary">開始評估新資料</button>

        <div id="evaluation-results" class="hidden">
            <h3>評估結果 (基於 <span id="eval-total-samples">...</span> 筆新資料)</h3>

            <div class="info-blocks-wrapper">
                <div class="info-card">
                    <h4>整體指標</h4>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-item-label">準確率 (Accuracy)</span>
                            <span class="info-item-value" id="eval-accuracy">...</span>
                        </div>
                        <div class="info-item">
                            <span class="info-item-label">召回率 (Recall)</span>
                            <span class="info-item-value" id="eval-recall">...</span>
                        </div>
                        <div class="info-item">
                            <span class="info-item-label">F1-Score</span>
                            <span class="info-item-value" id="eval-f1">...</span>
                        </div>
                        <div class="info-item">
                            <span class="info-item-label">AUC 分數</span>
                            <span class="info-item-value" id="eval-auc">...</span>
                        </div>
                    </div>
                </div>

                <div class="info-card">
                    <h4>混淆矩陣 (Confusion Matrix)</h4>
                    <table class="confusion-matrix">
                        <tr>
                            <td class="cm-label"></td>
                            <th class="cm-header">預測：沒有</th>
                            <th class="cm-header">預測：有</th>
                        </tr>
                        <tr>
                            <th class="cm-header">實際：沒有</th>
                            <td class="cm-cell" id="cm-tn">...</td>
                            <td class="cm-cell" id="cm-fp">...</td>
                        </tr>
                        <tr>
                            <th class="cm-header">實際：有</th>
                            <td class="cm-cell" id="cm-fn">...</td>
                            <td class="cm-cell" id="cm-tp">...</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="chart-container card-style">
    <h2>特徵分佈散佈圖 (200筆隨機樣本)</h2>
    <div class="chart-controls">
        <button id="chart-filter-all" class="chart-filter-btn active">全部顯示</button>
        <button id="chart-filter-no" class="chart-filter-btn">無離職傾向</button>
        <button id="chart-filter-yes" class="chart-filter-btn">有離職傾向</button>
    </div>
    <div class="chart-canvas-wrapper">
        <canvas id="scatterChart"></canvas>
    </div>
    <div class="chart-legend">
        <span class="legend-item legend-no">■ 無離職傾向</span>
        <span class="legend-item legend-yes">■ 有離職傾向</span>
    </div>
</div>

<div class="info-blocks-wrapper">
    <div class="info-card card-style">
        <h3>模型評估指標</h3>

        <div class="info-grid" id="model-evaluation-list">

            <div class="info-item">
                <span class="info-item-label">召回率</span>
                <span class="info-item-value" id="metric-recall">載入中...</span>
            </div>

            <div class="info-item">
                <span class="info-item-label">F1-Score</span>
                <span class="info-item-value" id="metric-f1">載入中...</span>
            </div>

            <div class="info-item">
                <span class="info-item-label">AUC 分數</span>
                <span class="info-item-value" id="metric-auc">載入中...</span>
            </div>

        </div>
    </div>

    <div class="info-card card-style">
        <h3>模型資訊</h3>

        <div class="info-grid" id="model-info-list">

            <div class="info-item">
                <span class="info-item-label">資料集</span>
                <span class="info-item-value" id="info-dataset-name">載入中...</span>
            </div>

            <div class="info-item">
                <span class="info-item-label">總樣本數</span>
                <span class="info-item-value" id="info-total-samples">載入中...</span>
            </div>

            <div class="info-item">
                <span class="info-item-label">訓練集大小</span>
                <span class="info-item-value" id="info-train-size">載入中...</span>
            </div>

            <div class="info-item">
                <span class="info-item-label">測試集大小</span>
                <span class="info-item-value" id="info-test-size">載入中...</span>
            </div>

            <div class="info-item">
                <span class="info-item-label">預測目標</span>
                <span class="info-item-value" id="info-target">載入中...</span>
            </div>

        </div>
    </div>

    <div class="info-card card-style">
        <h3 id="chart-info-title">圖表說明</h3>
        <p id="chart-info-description">載入中...</p>
    </div>
</div>

    
</div>

{% endblock %}

{% block code %}
<script src="{{ url_for('static', filename='vendor/chart.js/chart.umd.js') }}"></script>
<script src="{{ url_for('static', filename='js/random_forest.js') }}"></script>
{% endblock%}